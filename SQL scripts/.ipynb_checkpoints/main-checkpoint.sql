Смотри показатели: Маржа суммарная, Средняя маржа на чек, 
Количество уникальных артикулов, Арт/клиента, Средний GMV чеков без акции, 
с акцией и за прошлый год за каждую неделю акции до дня.



select
    opened_date::date                     AS "Дата продажи",
    store_id                              AS "Магазин",
    receipt_surrogate_id                     AS "Номер чека",
    ---client_type                           AS "Тип клиента",
    ---client_subtype                        AS "Карта",
    ---client_loyalty_card_number            AS "Номер сервисной карты",
    ---COALESCE(line_order_channel_calculated, 'OFFLINE') AS "Канал продажи",
    ---rms_department                        AS "Номер отдела",
    ---line_item_id                          AS "Артикул",
    ---line_article_description              AS "Наименование",
    line_turnover                         AS "GMV",
    line_margin                           AS "Маржа",
    sum(line_quantity)                    AS "Продано шт.",
    count (distinct (line_item_id))         AS "Уникальных арт.",
    CASE
        WHEN opened_date BETWEEN '2024-04-19' AND '2024-04-25' THEN '1 неделя'
        WHEN opened_date BETWEEN '2024-04-26' AND '2024-05-02' THEN '2 неделя'
        WHEN opened_date BETWEEN '2024-05-03' AND '2024-05-09' THEN '3 неделя'
        WHEN opened_date BETWEEN '2024-05-10' AND '2024-05-16' THEN '4 неделя'
        WHEN opened_date BETWEEN '2024-05-17' AND '2024-05-23' THEN '5 неделя'
        ELSE 'Unknown Week'
    END AS "Неделя"
FROM dds.v_receipt_lines_public vrlp
where 
    line_item_type = 'Normal' --Только товары
    AND line_type IN ('Sales', 'pickedUp orders', 'Returns') --С возвратами
    and COALESCE(line_order_channel_calculated, 'OFFLINE') = 'OFFLINE'
    and client_subtype in ('Service Card', 'Corporate Card')
    AND (
        (line_item_id = '85539218' AND store_id IN (10, 11, 41, 42, 134, 135, 136, 137, 138, 140, 141) AND opened_date BETWEEN '2024-04-19' AND '2024-04-25') OR
        (line_item_id = '89353945' AND store_id IN (2, 3, 4, 5, 6, 20, 22, 26, 28, 32, 35, 40, 43, 49, 51, 56, 65, 86, 114, 117, 118, 122, 126, 143, 153, 169) AND opened_date BETWEEN '2024-04-19' AND '2024-04-25') OR
        (line_item_id = '89179009' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-19' AND '2024-04-25') OR
        (line_item_id = '89358703' AND store_id IN (2, 3, 4, 5, 6, 10, 11, 20, 22, 26, 28, 32, 35, 40, 41, 42, 43, 49, 51, 56, 65, 86, 114, 117, 118, 122, 126, 134, 135, 136, 137, 138, 140, 141, 143, 153, 169) AND opened_date BETWEEN '2024-04-19' AND '2024-04-25') OR
        (line_item_id = '89353951' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-19' AND '2024-04-25') OR
        (line_item_id = '89365954' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-19' AND '2024-04-25') OR
        (line_item_id = '85106534' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-19' AND '2024-04-25') OR
        (line_item_id = '89364106' AND store_id IN (2, 3, 4, 5, 6, 10, 11, 20, 22, 26, 28, 32, 35, 40, 41, 42, 43, 49, 51, 56, 65, 86, 114, 117, 118, 122, 126, 134, 135, 136, 137, 138, 140, 141, 143, 153, 169) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '18864501' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025368' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025370' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025369' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025371' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025372' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025373' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025374' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025375' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025376' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89025377' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '14147003' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '84841832' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-04-26' AND '2024-05-02') OR
        (line_item_id = '89359491' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-03' AND '2024-05-09') OR
        (line_item_id = '82327005' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-03' AND '2024-05-09') OR
        (line_item_id = '85544111' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-03' AND '2024-05-09') OR
        (line_item_id = '85544116' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-03' AND '2024-05-09') OR
        (line_item_id = '18722589' AND store_id IN (2, 3, 4, 5, 6, 10, 11, 20, 22, 26, 28, 32, 35, 40, 41, 42, 43, 49, 51, 56, 65, 86, 114, 117, 118, 122, 126, 134, 135, 136, 137, 138, 140, 141, 143, 153, 169) AND opened_date BETWEEN '2024-05-03' AND '2024-05-09') OR
        (line_item_id = '81968251' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-03' AND '2024-05-09') OR
        (line_item_id = '81968249' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-03' AND '2024-05-09') OR
        (line_item_id = '14348374' AND store_id IN (2, 3, 4, 5, 22, 28, 35, 40, 43, 49, 65, 86, 114, 118, 126, 143, 153) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '89358024' AND store_id IN (12, 16, 23, 30, 36, 37, 52, 55, 58, 59, 67, 68, 75, 81, 82, 87, 88, 89, 91, 93, 123, 124, 128, 129) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '89368731' AND store_id IN (6, 9, 10, 11, 13, 17, 18, 19, 20, 25, 26, 31, 32, 33, 34, 38, 41, 42, 47, 48, 51, 53, 56, 57, 71, 74, 78, 79, 80, 83, 110, 117, 122, 127, 134, 135, 136, 137, 138, 140, 141, 142, 156, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '11725779' AND store_id IN (7, 8, 14, 21, 24, 27, 39, 46, 69, 70, 73, 77, 92, 94, 109, 111, 115, 119, 147, 150, 155, 163, 165) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '84375946' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '87815383' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '87815384' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '87815382' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '87815385' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '17983824' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '84659727' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '84659728' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '17983841' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '81992740' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-10' AND '2024-05-16') OR
        (line_item_id = '83422542' AND store_id IN (10, 11, 41, 42, 134, 135, 136, 137, 138, 140, 141, 2, 3, 4, 5, 20, 22, 26, 28, 32, 35, 40, 43, 49, 51, 56, 65, 86, 114, 117, 118, 122, 126, 142, 143, 153, 169) AND opened_date BETWEEN '2024-05-17' AND '2024-05-23') OR
        (line_item_id = '89367194' AND store_id IN (2, 3, 4, 5, 6, 10, 11, 20, 22, 26, 28, 32, 35, 40, 41, 42, 43, 49, 51, 56, 65, 86, 114, 117, 118, 122, 126, 134, 135, 136, 137, 138, 140, 141, 143, 153, 169) AND opened_date BETWEEN '2024-05-17' AND '2024-05-23') OR
        (line_item_id = '89353949' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-17' AND '2024-05-23') OR
        (line_item_id = '89364938' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-17' AND '2024-05-23') OR
        (line_item_id = '89366396' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-17' AND '2024-05-23') OR
        (line_item_id = '82260136' AND store_id IN (2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 46, 47, 48, 49, 51, 52, 53, 55, 56, 57, 58, 59, 65, 67, 68, 69, 70, 71, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 109, 110, 111, 114, 115, 117, 118, 119, 122, 123, 124, 126, 127, 128, 129, 134, 135, 136, 137, 138, 140, 141, 142, 143, 147, 150, 153, 155, 156, 163, 165, 169, 181) AND opened_date BETWEEN '2024-05-17' AND '2024-05-23')
    )
    group by 
    opened_date::date,
    store_id,
    receipt_surrogate_id,
    line_turnover,
    line_margin,
        CASE
        WHEN opened_date BETWEEN '2024-04-19' AND '2024-04-25' THEN '1 неделя'
        WHEN opened_date BETWEEN '2024-04-26' AND '2024-05-02' THEN '2 неделя'
        WHEN opened_date BETWEEN '2024-05-03' AND '2024-05-09' THEN '3 неделя'
        WHEN opened_date BETWEEN '2024-05-10' AND '2024-05-16' THEN '4 неделя'
        WHEN opened_date BETWEEN '2024-05-17' AND '2024-05-23' THEN '5 неделя'
        ELSE 'Unknown Week'
    END